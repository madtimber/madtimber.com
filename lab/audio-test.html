<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<title>HTML5 &lt;audio&gt; test.</title>
		<link rel="stylesheet" type="text/css" href="css/audio-test.css" />
		<link rel="stylesheet" type="text/css" href="css/audio-test-tablet.css" media="screen and (min-device-width: 481px) and (max-device-width: 799px)" />
		<link rel="stylesheet" type="text/css" href="css/audio-test-mobile.css" media="only screen and (max-device-width: 480px)" />
	</head>
	<body>
		<h1>HTML5 &lt;audio&gt; test</h1>
		<audio id="audio1">
			<source src="../music/test.mp3" type="audio/mp3" />
		</audio>
		
		<div id="da1">
			<span id="play">play/pause</span>
			<span id="restart">restart</span>
		</div>
		
		<div id="time_info">
			<span>Timer: <span id="timer">0:00</span> of <span id="duration"></span> (<span id="percent"></span>)</span>
			<div id="prog-indicator"><span id="indicator"></span></div>
		</div>
		<script>
			
			document.getElementById("play").addEventListener('click', function(e) {	
				newPlayer.playPause();		
			}, false);
			
			document.getElementById("restart").addEventListener('click', function(e) {
			//	var player = document.getElementById("audio1");
			//	player.currentTime = 0;
			//	setTimer(0);
			
				newPlayer.restart();
				
			//	setProgressIndicator(player.currentTime, player.duration);

			}, false);
			
			document.getElementById("audio1").addEventListener('timeupdate', function(e) {
				// set current timer element
				setTimer(this.currentTime);
				
				// set the duration element
				var duration = document.getElementById("duration");
				var d= secondsToTime(Math.round(this.duration));
				duration.innerText = d.m + ":" + d.s;
				
				// update the progress indicator
				setProgressIndicator(this.currentTime, Math.round(this.duration));
				
			}, false);
			
	//		function setProgressIndicator(currentTime, duration) {
	//			var holder = document.getElementById("prog-indicator");
	//			var holderWidth = holder.clientWidth;
	//			var percent = (duration == 0) ? 0 : (currentTime/duration);
				
	//			var indicator = document.getElementById("indicator");
	//			var percent_el = document.getElementById("percent");
				
		//		indicator.style.width = Math.floor(holderWidth*percent)+"px";
		//		percent_el.innerText = Math.round(percent*100)+"%";
		//	}
			
		//	function setTimer(sec) {
		//		var timer = document.getElementById("timer");
		//		var currentTime = secondsToTime(Math.round(sec));
		//		timer.innerText = currentTime.m + ":" + currentTime.s;
		//	}
			
			function HTML5Player(id) {
				
				var currTime;
				var timer = null;
				var progIndicatorHolderEl = null;
				var progIndicatorEl = null;
				var percentEl = null;
				var timerEl = null;
				var player;
				var duration;
				
				function secondsToTime(n) {
					var minutes = Math.floor(n / 60);
					var secs = n % 60;

					if (secs < 10) {
						secs = "0"+secs;
					}

					var obj = {
						"m" : minutes,
						"s" : secs
					};

					return obj;
				}
				
				function setProgressIndicator() {
					var holderWidth = progIndicatorHolder.clientWidth;
					var percent = (player.duration == 0) ? 0 : (player.currentTime/player.duration);

					progIndicator.style.width = Math.floor(holderWidth*percent)+"px";
					percentEl.innerText = Math.round(percent*100)+"%";
				}
				
				return {
					init: function(id) {
						player = document.getElementById(id);
						duration = player.duration;
					},
					playPause: function() {
						if(player.paused) {
							player.play();
						} else {
							player.pause();
						}
					},
					restart:  function() {
						player.currentTime = 0;
						
						if(progIndicator) {
							setProgressIndicator();
						}
					},
					initTimer: function(id) {
						timerEl = document.getElementById(id);
					},
					setTimer:  function(sec) {
						var currentTime = secondsToTime(Math.round(sec));
						timerEl.innerText = currentTime.m + ":" + currentTime.s;
					},
					initProgIndicator: function(indicatorHolderID, indicatorID, percentID) {
						progIndicatorHolder = document.getElementById(indicatorHolderID);
						progIndicator = document.getElementById(indicatorID);
						percentEl = document.getElementById(percentID);
					},
					onTimeUpdate: function(func) {
						player.addEventListener('timeupdate', function(e) {
							func.call(this, e);
						}, false);
					}
				};
			}
			
			var newPlayer = HTML5Player();
			newPlayer.init("audio1");
			newPlayer.initProgIndicator("prog-indicator", "indicator", "percent");
			newPlayer.initTimer("timer");
			newPlayer.onTimeUpdate(function(e) {
				this.setTimer(this.currentTime);		
				
				var duration = document.getElementById("duration");
				var d= secondsToTime(Math.round(this.duration));
				duration.innerText = d.m + ":" + d.s;
			})
			
		</script>
	</body>
</html>